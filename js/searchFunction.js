var products = [

    {
        id: '1',
        image: '../access/img/list-img-9.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Ombar'
    },
    {
        id: '2',
        image: '../access/img/list-img-40.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'BRANDS'
    },
    {
        id: '3',
        image: '../access/img/list-img-1.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Consious Chocolate'
    },
    {
        id: '4',
        image: '../access/img/list-img-45.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Element for life'
    },
    {
        id: '5',
        image: '../access/img/list-img-14.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Enjoy'
    },
    {
        id: '6',
        image: '../access/img/list-img-19.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Forever Cacao'
    },
    {
        id: '7',
        image: '../access/img/list-img-20.webp',
        name: 'Peruvian Organic Raw Cacao Butter (250g)',
        price: '£7.49',
        category: 'Ombar'
    },
    {
        id: '8',
        image: '../access/img/list-img-21.webp',
        name: 'Conscious Citrus Zest',
        weight: '60g',
        price: '£2.99',
        category: 'Ombar'
    },
    {
        id: '9',
        image: '../access/img/list-img-34.jpg',
        name: 'Conscious Dark Side 85%',
        weight: '60g',
        price: '£3.99',
        category: 'Forever Cacao'
    },
    {
        id: '10',
        image: '../access/img/list-img-38.webp',
        name: 'Conscious Four Nuts',
        weight: '60g',
        price: '£2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '11',
        image: '../access/img/list-img-15.webp',
        name: 'Conscious Goji and Coconut',
        weight: '60g',
        price: '£2.99',
        category: 'Enjoy'
    },
    {
        id: '12',
        image: '../access/img/list-img-2.webp',
        name: 'Conscious Love Potion No.9',
        weight: '60g',
        price: '£2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '13',
        image: '../access/img/list-img-22.webp',
        name: 'Conscious Maca & Sprirulina',
        weight: '60g',
        price: '£2.99',
        category: 'Ombar'
    },
    {
        id: '14',
        image: '../access/img/list-img-29.webp',
        name: 'Conscious Orange & Tanregine',
        weight: '60g',
        price: '£2.99',
        category: 'Ombar'
    },
    {
        id: '15',
        image: '../access/img/list-img-3.webp',
        name: 'Coracao 81% Cacao Bar',
        weight: '(2oz/57g)',
        price: '£3.99',
        category: 'Consious Chocolate'

    },
    {
        id: '16',
        image: '../access/img/list-img-4.webp',
        name: 'Coracao After Dark Bar',
        weight: '(2oz/57g)',
        price: '£3.99',
        category: 'Consious Chocolate'
    },
    {
        id: '17',
        image: '../access/img/list-img-39.webp',
        name: 'Coracao Berkeley Bar',
        weight: '(2.5oz/70g)',
        price: '£2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '18',
        image: '../access/img/list-img-16.webp',
        name: 'Coracao Caramel Bar',
        weight: '(2.5oz/70g)',
        price: '£2.99',
        category: 'Enjoy'
    },
    {
        id: '19',
        image: '../access/img/list-img-17.webp',
        name: 'Coracao Hazelnut Cream Bar',
        weight: '(2oz/56g)',
        price: '£2.99',
        category: 'Enjoy'
    },
    {
        id: '20',
        image: '../access/img/list-img-18.webp',
        name: 'Yummy Scrummy Raw Chocolate Brownie',
        price: 'from £2.99',
        category: 'Enjoy'
    },
    {
        id: '21',
        image: '../access/img/list-img-31.webp',
        name: 'Enjoy! Coconut Milk',
        weight: '(70g)',
        price: 'from £2.99',
        category: 'Ombar'
    },
    {
        id: '22',

        image: '../access/img/list-img-30.webp',
        name: 'Yummy Scrummy Raw Chocolate Brownie',
        weight: ' ',
        price: 'from £2.99',
        category: 'Ombar'
    },
    {
        id: '23',

        image: '../access/img/list-img-41.webp',
        name: 'Enjoy! Daringly Darkest 85%',
        weight: '(70g)',
        price: 'from £2.99',
        category: 'BRANDS'
    },
    {
        id: '24',

        image: '../access/img/list-img-5.webp',
        name: 'Enjoy! Delightfully Dark 70% (70g)',
        weight: ' ',
        price: 'from £2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '25',

        image: '../access/img/list-img-6.webp',
        name: 'Enjoy! Delightfully Dark 70%',
        weight: 'Button (96g)',
        price: 'from £2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '26',

        image: '../access/img/list-img-7.webp',
        name: 'Enjoy! Magical Mint',
        weight: 'Button (96g)',
        price: 'from £2.99',
        category: 'Consious Chocolate'
    },
    {
        id: '27',

        image: '../access/img/list-img-42.webp',
        name: 'Enjoy! Mint',
        weight: '(70g)',
        price: 'from £2.99',
        category: 'BRANDS'
    },
    {
        id: '28',
        image: '../access/img/list-img-43.webp',
        name: 'Forever Cacao: Bean to Bar 100%)',
        weight: ' ',
        price: 'from £3.99',
        category: 'BRANDS'
    },
    {
        id: '29',

        image: '../access/img/list-img-44.webp',
        name: 'Forever Cacao: Bean to Bar 55%',
        weight: ' ',
        price: 'from £3.99',
        category: 'BRANDS'
    },
    {
        id: '30',
        image: '../access/img/list-img-46.webp',
        name: 'Forever Cacao: Bean to Bar 65%',
        weight: '(70g)',
        price: 'from £3.99',
        category: 'Enjoy'
    },
    {
        id: '31',
        image: '../access/img/list-img-47.webp',
        name: 'Forever Cacao: Bean to Bar 75%',
        weight: '(70g)',
        price: 'from £3.99',
        category: 'Enjoy'
    },
    {
        id: '32',
        image: '../access/img/list-img-26.webp',
        name: 'Ombar 100% Organic Chocolate ',
        weight: '(35g)',
        price: 'from £3.99',
        category: 'Enjoy'
    },
    {
        id: '33',
        image: '../access/img/list-img-27.webp',
        name: 'Ombar 72% Organic Chocolate ',
        weight: '(35g)',
        price: '£3.99',
        category: 'Enjoy'
    },
    {
        id: '34',
        image: '../access/img/list-img-28.webp',
        name: 'Ombar 100% Organic Chocolate ',
        weight: '(70g)',
        price: '£3.99',
        category: 'Enjoy'
    },
    {
        id: '35',
        image: '../access/img/list-img-23.webp',
        name: 'Coracao 81% Cacao Bar',
        weight: '(57g)',
        price: '£6.99',
        category: 'Coracao Confections'
    },
    {
        id: '36',
        image: '../access/img/list-img-24.webp',
        name: 'Coracao Caramel Bar',
        weight: '(70g)',
        price: '£5.99',
        category: 'Coracao Confections'
    },
    {
        id: '37',
        image: '../access/img/list-img-35.jpg',
        name: 'Coracao Mint Fudge Bar',
        weight: '(70g)',
        price: '£6.49',
        category: 'Forever Cacao'
    },
    {
        id: '38',
        image: '../access/img/list-img-25.webp',
        name: 'Coracao Mint Fudge Bar',
        weight: '(70g)',
        price: '£6.49',
        category: 'Coracao Confections'
    },
    {
        id: '39',
        image: '../access/img/list-img-36.webp',
        name: 'Coracao Mint Fudge Bar',
        weight: '(70g)',
        price: '£6.49',
        category: 'Forever Cacao'
    },
    {
        id: '40',
        image: '../access/img/list-img-37.jpg',
        name: 'Coracao Mint Fudge Bar',
        weight: '(70g)',
        price: '£6.49',
        category: 'Forever Cacao'
    }
    

    
    
    
]
if (localStorage.getItem("products") == null) {
    products = localStorage.setItem("products", JSON.stringify(products));
}
window.onload = addCategory();
window.onload = addKeyBoardSearch();
window.onload = showListCategory();
window.onload = addHideListSearch();
function addKeyBoardSearch() {
    let searchKeyboard = document.getElementById("searchInput");
    searchKeyboard.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            let category = document.getElementById("categoryList").value;
            let minPrice = document.getElementById("minRange").value;
            let maxPrice = document.getElementById("maxRange").value;
            localStorage.setItem("findProduct", JSON.stringify(controllerFindProduct(searchKeyboard.value, category, minPrice, maxPrice)));
            document.getElementById('requiredContainer').setAttribute('class', 'hidden');
            redirectPage('search.html');
            loadSearchProduct(1);
        }
    })
};
function addHideListSearch() {
    let listRequired = document.getElementById("searchInput");
    listRequired.addEventListener('focusin', (event) => {
        let listRequired = document.getElementById("requiredContainer");
        listRequired.setAttribute('class', 'show-block');
    });
    // listRequired.addEventListener('focusout',(event)=>{
    //     let listRequired=document.getElementById("requiredContainer");
    //     listRequired.setAttribute('class','hidden');
    // });
}

function renderProduct(category, object, paginationIndex) {
    if(typeof paginationIndex =="undefined"){
        paginationIndex=1;
    }
    let listProducts = controllerFindProduct('', category, '', '');
    let objectName='';
    if(localStorage.getItem('currentPage')=="thechocolates.html"){
            objectName="chocolate";
    }else if(localStorage.getItem('currentPage')=="search.html"){
            objectName="search";
    }
    // let listProductObject = document.getElementsByClassName('right-'+objectName)[0];
    // let user = JSON.parse(localStorage.getItem('user'));
    // let HTML = '';
    // let functionHandle = '';
    // if (user.role === "admin") {
    //     iconHandle = 'ti-settings icon_hover';
    //     functionHandle = 'redirectUpdateProduct(this)';
    // } else {
    //     iconHandle = 'ti-shopping-cart-full icon_hover';
    //     functionHandle = 'addToCart(this);'
    // }
    // for (let i = 0; i < listProducts.length; i++) {
    //     HTML += `
    //     <div class="card">
    //    <div class="card-header" style="position: relative;">
    //      <img class="img-card" src="${listProducts[i].image}" alt="Sr error !" />
    //      <ul class="product_hover">
    //        <li>
    //          <a href="${listProducts[i].image}">
    //            <span class="ti-arrows-corner icon_hover" style="color: white;"></span>
    //          </a>
    //        </li>
    //        <li>
    //          <a href="#">
    //              <span></span>
    //          </a>
    //        </li>
    //        <li>
    //          <a href="#">
    //              <span id="${listProducts[i].id}" onclick="${functionHandle}" class="${iconHandle}"></span>
    //          </a>
    //        </li>
    //      </ul>
    //    </div>
    //    <div class="card-body">
    //      <div class="card-reviews">
    //        <i class="ti-star"></i>
    //        <i class="ti-star"></i>
    //        <i class="ti-star"></i>
    //        <i class="ti-star"></i>
    //        <i class="ti-star"></i>
    //        <p class="status-review">review</p>
    //      </div>
    //      <div class="card-infor">
    //        <span class="infor-name">
    //         ${listProducts[i].name}
    //        </span>
    //        <span class="infor-price">${listProducts[i].price}</span>
    //      </div>
    //    </div>
    //  </div>`
    // }
    
    // listProductObject.innerHTML = HTML;
    loadSearchProduct(paginationIndex,listProducts);
    let selectedObject = document.getElementsByClassName('title-left-'+objectName)[0];
    let title = document.getElementsByClassName('heading-'+objectName)[0];
    title.innerText = category;
    selectedObject.setAttribute('class', '');
    selectedObject.nextElementSibling.setAttribute('class', 'left-space hidden');
    let listLeftChild=document.getElementsByClassName('left-'+objectName)[0].firstElementChild.children;
    for(let i=0;i<listLeftChild.length;i+=2){
        if(listLeftChild[i].innerText.includes(category)){
            listLeftChild[i].setAttribute('class', 'title-left title-left-'+objectName+' active');
            listLeftChild[i].nextElementSibling.setAttribute('class','left-space');
            break;
        }
    }
    
}
function renderProductAndRedirect(category, object, link) {
    window.location = link;
    renderProduct(category, object);
}
function controllerFindProduct(productName, category, minPrice, maxPrice) {
    return findProductByName(productName, findProductByRange(minPrice, maxPrice, findProductBycategory(category)));
}
//arrow funtion

function findProductBycategory(category) {
    let products=JSON.parse(localStorage.getItem('products'));
    if (category != 'All' && typeof category !== 'undefined') {
        let findProduct = [];
        for (let i = 0; i < products.length; i++) {
            if ((products[i].category) === category) {
                findProduct.push(products[i]);
            }
        }
        return findProduct;
    } else {
        return products;
    }
}
function findProductByRange(minPrice, maxPrice, beforeList) {
    let findProduct = [];
    if (typeof minPrice !== 'undefined' && typeof maxPrice !== 'undefined') {
        if (maxPrice == '') {
            maxPrice = 1.7976931348623157e+308;
        }
        if (minPrice == '') {
            minPrice = 0;
        }
        for (let i = 0; i < beforeList.length; i++) {
            if (!(beforeList[i].price).includes('Sold out') && (parseFloat(((beforeList[i].price).split("£")[1]))) >= minPrice && (parseFloat(((beforeList[i].price).split("£")[1]))) <= maxPrice) {
                findProduct.push(beforeList[i]);
            }
        }
        return findProduct;
    } else {
        return beforeList;
    }
}
function findProductByName(productName, beforeList) {
    let findProduct = [];
    if (productName != '') {
        for (let i = 0; i < beforeList.length; i++) {
            if ((beforeList[i].name).includes(productName)) {
                findProduct.push(beforeList[i]);
            }
        }
        return findProduct;
    } else {
        return beforeList;
    }
}
function addCategory() {
    let category = [
        "BRANDS", "Consious Chocolate", "Coracao Confections", "Element for life", "Enjoy", "Forever Cacao", "Ombar"
    ]
    localStorage.setItem("categories", JSON.stringify(category));
}
function showListCategory() {
    let categories = JSON.parse(localStorage.getItem("categories"));
    let categoryList = document.getElementById("categoryList");
    let category = [categories.length];
    for (var i = 0; i < categories.length; i++) {
        category[i] = document.createElement("option");
        category[i].setAttribute("value", categories[i]);
        category[i].innerHTML = categories[i];
        categoryList.appendChild(category[i]);
    }
}
function showListSearch() {
    let listRequired = document.getElementById("requiredContainer");
    listRequired.setAttribute("class", "show-flex");

}
function hideListSearch() {
    let listRequired = document.getElementById("requiredContainer");
    listRequired.setAttribute('class', 'hidden');
}
function redirectUpdateProduct(product) {
    localStorage.setItem('redirectAction', 'updateProduct');
    localStorage.setItem('redirectParameter', JSON.stringify(product.getAttribute("id")));
    window.location = "settings.html"
}
